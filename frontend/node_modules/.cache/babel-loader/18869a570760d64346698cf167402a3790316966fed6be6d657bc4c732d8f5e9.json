{"ast":null,"code":"import React,{useState,useEffect}from'react';import'./App.css';import Login from'./components/Login';import Register from'./components/Register';import Dashboard from'./components/Dashboard';import{handleApiError,showErrorToast,showSuccessToast}from'./utils/errorHandler';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE='/api';function App(){const[user,setUser]=useState(null);const[showRegister,setShowRegister]=useState(false);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const token=localStorage.getItem('token');if(token){fetchUserData(token);}else{setLoading(false);}},[]);const fetchUserData=async token=>{try{const response=await fetch(\"\".concat(API_BASE,\"/users/me\"),{headers:{'Authorization':\"Bearer \".concat(token)}});const userData=await handleApiError(response);setUser(userData);setError(null);}catch(error){console.error('Error fetching user data:',error);localStorage.removeItem('token');setError('Session expired. Please login again.');}finally{setLoading(false);}};const handleLogin=async credentials=>{try{setError(null);const response=await fetch(\"\".concat(API_BASE,\"/auth/login\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(credentials)});const data=await handleApiError(response);localStorage.setItem('token',data.access_token);await fetchUserData(data.access_token);showSuccessToast('Login successful!');}catch(error){console.error('Login error:',error);setError(error.message);showErrorToast(error.message);}};const handleRegister=async userData=>{try{setError(null);const response=await fetch(\"\".concat(API_BASE,\"/auth/register\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(userData)});await handleApiError(response);showSuccessToast('Registration successful! Please login.');setShowRegister(false);}catch(error){console.error('Register error:',error);setError(error.message);showErrorToast(error.message);}};const handleLogout=()=>{localStorage.removeItem('token');setUser(null);setError(null);showSuccessToast('Logged out successfully');};if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"app\",children:[error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-banner\",children:[error,/*#__PURE__*/_jsx(\"button\",{onClick:()=>setError(null),className:\"close-error\",children:\"\\xD7\"})]}),!user?showRegister?/*#__PURE__*/_jsx(Register,{onRegister:handleRegister,onSwitchToLogin:()=>setShowRegister(false)}):/*#__PURE__*/_jsx(Login,{onLogin:handleLogin,onSwitchToRegister:()=>setShowRegister(true)}):/*#__PURE__*/_jsx(Dashboard,{user:user,onLogout:handleLogout})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","Login","Register","Dashboard","handleApiError","showErrorToast","showSuccessToast","jsx","_jsx","jsxs","_jsxs","API_BASE","App","user","setUser","showRegister","setShowRegister","loading","setLoading","error","setError","token","localStorage","getItem","fetchUserData","response","fetch","concat","headers","userData","console","removeItem","handleLogin","credentials","method","body","JSON","stringify","data","setItem","access_token","message","handleRegister","handleLogout","className","children","onClick","onRegister","onSwitchToLogin","onLogin","onSwitchToRegister","onLogout"],"sources":["/home/istin-linux/Рабочий стол/DevOps_todo-app/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport './App.css';\nimport Login from './components/Login';\nimport Register from './components/Register';\nimport Dashboard from './components/Dashboard';\nimport { handleApiError, showErrorToast, showSuccessToast } from './utils/errorHandler';\n\nconst API_BASE = '/api';\n\nfunction App() {\n  const [user, setUser] = useState(null);\n  const [showRegister, setShowRegister] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      fetchUserData(token);\n    } else {\n      setLoading(false);\n    }\n  }, []);\n\n  const fetchUserData = async (token) => {\n    try {\n      const response = await fetch(`${API_BASE}/users/me`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      \n      const userData = await handleApiError(response);\n      setUser(userData);\n      setError(null);\n    } catch (error) {\n      console.error('Error fetching user data:', error);\n      localStorage.removeItem('token');\n      setError('Session expired. Please login again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleLogin = async (credentials) => {\n    try {\n      setError(null);\n      const response = await fetch(`${API_BASE}/auth/login`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(credentials),\n      });\n\n      const data = await handleApiError(response);\n      localStorage.setItem('token', data.access_token);\n      await fetchUserData(data.access_token);\n      showSuccessToast('Login successful!');\n    } catch (error) {\n      console.error('Login error:', error);\n      setError(error.message);\n      showErrorToast(error.message);\n    }\n  };\n\n  const handleRegister = async (userData) => {\n    try {\n      setError(null);\n      const response = await fetch(`${API_BASE}/auth/register`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(userData),\n      });\n\n      await handleApiError(response);\n      showSuccessToast('Registration successful! Please login.');\n      setShowRegister(false);\n    } catch (error) {\n      console.error('Register error:', error);\n      setError(error.message);\n      showErrorToast(error.message);\n    }\n  };\n\n  const handleLogout = () => {\n    localStorage.removeItem('token');\n    setUser(null);\n    setError(null);\n    showSuccessToast('Logged out successfully');\n  };\n\n  if (loading) {\n    return (\n      <div className=\"loading\">\n        <div className=\"spinner\"></div>\n        <p>Loading...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"app\">\n      {error && (\n        <div className=\"error-banner\">\n          {error}\n          <button onClick={() => setError(null)} className=\"close-error\">×</button>\n        </div>\n      )}\n      \n      {!user ? (\n        showRegister ? (\n          <Register onRegister={handleRegister} onSwitchToLogin={() => setShowRegister(false)} />\n        ) : (\n          <Login onLogin={handleLogin} onSwitchToRegister={() => setShowRegister(true)} />\n        )\n      ) : (\n        <Dashboard user={user} onLogout={handleLogout} />\n      )}\n    </div>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}